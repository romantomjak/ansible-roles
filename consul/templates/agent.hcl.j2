# {{ ansible_managed }}. Created on {{ template_run_date }}

primary_datacenter = "{{ consul_datacenter }}"

datacenter = "{{ consul_datacenter }}"

encrypt = "{{ consul_encrypt }}"

data_dir = "{{ consul_data_dir }}"

enable_syslog = {{ consul_enable_syslog | to_json }}

#
# Features
#

acl {
  enabled = {{ consul_acl_enabled | to_json }}
  default_policy = "{{ consul_acl_default_policy }}"
  down_policy = "{{ consul_acl_down_policy }}"
  enable_token_persistence = {{ consul_acl_enable_token_persistence | to_json }}

  tokens {
    agent = "{{ consul_acl_agent_token }}"
  } 
}

ui_config {
  enabled = {{ consul_ui_enabled | to_json }}
}

#
# Network
#

bind_addr = "{{ consul_bind_addr }}"

client_addr = "{{ consul_client_addr }}"

ports = {
{% for key, val in consul_ports.items() %}
    {{ key }} = {{ val }}
{% endfor %}
}

#
# Discovery
#

{% if consul_recursors %}
recursors = "{{ consul_recursors }}"
{% endif %}

{% if consul_retry_join %}
retry_join = "{{ consul_retry_join }}"
{% endif %}

#
# TLS
#

verify_incoming = true
verify_outgoing = true
verify_server_hostname = true

ca_file = "/etc/consul.d/pki/consul-agent-ca.pem"
cert_file = "/etc/consul.d/pki/{{ consul_datacenter }}-{{ consul_agent_type }}-consul-0.pem"
key_file = "/etc/consul.d/pki/{{ consul_datacenter }}-{{ consul_agent_type }}-consul-0-key.pem"
